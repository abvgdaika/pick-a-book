const books = {
    "detective": [
        {
            "title": "Мальтийский сокол",
            "author": "Дэшил Хэммет"
        },
        {
            "title": "Рассказы о Тайне и Воображении",
            "author": "Эдгар Аллан По"
        },
        {
            "title": "Дочь времени",
            "author": "Джозефина Тэй"
        },
        {
            "title": "Презумпция невиновности",
            "author": "Скотт Туроу"
        },
        {
            "title": "Шпион, пришедший с холода",
            "author": "Джон Ле Карре"
        },
        {
            "title": "Лунный камень",
            "author": "Уилки Коллинз"
        },
        {
            "title": "Глубокий сон",
            "author": "Рэймонд Чандлер"
        },
        {
            "title": "Ребекка",
            "author": "Дафна Дюморье"
        },
        {
            "title": "Десять негритят",
            "author": "Агата Кристи"
        },
        {
            "title": "Анатомия убийства",
            "author": "Роберт Трэвер"
        },
        {
            "title": "Убийство Роджера Экройда",
            "author": "Агата Кристи"
        },
        {
            "title": "Долгое прощание",
            "author": "Рэймонд Чандлер"
        },
        {
            "title": "Почтальон всегда звонит дважды",
            "author": "Джеймс Кейн"
        },
        {
            "title": "Крёстный отец",
            "author": "Марио Пьюзо"
        },
        {
            "title": "Молчание ягнят",
            "author": "Томас Харрис"
        },
        {
            "title": "Маска Димитриоса",
            "author": "Эрик Эмблер"
        },
        {
            "title": "Яркая ночь",
            "author": "Дороти Ли Сэйерс"
        },
        {
            "title": "Свидетель обвинения и другие истории",
            "author": "Агата Кристи"
        },
        {
            "title": "День Шакала",
            "author": "Фредерик Форсайт"
        },
        {
            "title": "Прощай, любимая",
            "author": "Рэймонд Чандлер"
        },
        {
            "title": "39 ступеней",
            "author": "Джон Бакен"
        },
        {
            "title": "Имя Розы",
            "author": "Умберто Эко"
        },
        {
            "title": "Преступление и наказание",
            "author": "Фёдор Достоевский"
        },
        {
            "title": "Игольное ушко",
            "author": "Кен Фоллетт"
        },
        {
            "title": "Rumpole of the Bailey",
            "author": "Джон Мортимер"
        },
        {
            "title": "Красный дракон",
            "author": "Томас Харрис"
        },
        {
            "title": "Девять ударов за упокой",
            "author": "Дороти Ли Сэйерс"
        },
        {
            "title": "Флетч",
            "author": "Грегори Макдональд"
        },
        {
            "title": "Шпион, выйди вон!",
            "author": "Джон Ле Карре"
        },
        {
            "title": "Худой",
            "author": "Дэшил Хэммет"
        },
        {
            "title": "Женщина в белом",
            "author": "Уилки Коллинз"
        },
        {
            "title": "Последнее дело Трента",
            "author": "Э. К. Бентли"
        },
        {
            "title": "Двойная страховка",
            "author": "Джеймс Кейн"
        },
        {
            "title": "Парк Горького",
            "author": "Мартин Круз Смит"
        },
        {
            "title": "Сильный яд",
            "author": "Дороти Ли Сэйерс"
        },
        {
            "title": "Dance Hall of the Dead",
            "author": "Тони Хиллерман"
        },
        {
            "title": "Проклятый изумруд",
            "author": "Дональд Уэстлейк"
        },
        {
            "title": "Кровавая жатва",
            "author": "Дэшил Хэммет"
        },
        {
            "title": "Винтовая лестница",
            "author": "Мэри Робертс Райнхарт"
        },
        {
            "title": "Убийство в Восточном экспрессе",
            "author": "Агата Кристи"
        },
        {
            "title": "Фирма",
            "author": "Джон Гришэм"
        },
        {
            "title": "Досье Ипкресс",
            "author": "Лен Дейтон"
        },
        {
            "title": "Лора",
            "author": "Вера Каспари"
        },
        {
            "title": "Смеющийся полицейский",
            "author": "Пер Валё и Май Шёвалль"
        },
        {
            "title": "Ограбление банка",
            "author": "Дональд Уэстлейк"
        },
        {
            "title": "Третий",
            "author": "Грэм Грин"
        },
        {
            "title": "Убийца внутри меня",
            "author": "Джим Томпсон"
        },
        {
            "title": "Дети не вернутся",
            "author": "Мэри Хиггинс Кларк"
        },
        {
            "title": "Первый смертный грех",
            "author": "Лоуренс Сандерс"
        },
        {
            "title": "A Thief of Time",
            "author": "Тони Хиллерман"
        },
        {
            "title": "Хладнокровное убийство",
            "author": "Трумен Капоте"
        },
        {
            "title": "Одинокий волк",
            "author": "Джеффри Хаусхолд"
        },
        {
            "title": "Смерть по объявлению",
            "author": "Дороти Ли Сэйерс"
        },
        {
            "title": "Команда Смайли",
            "author": "Джон Ле Карре"
        },
        {
            "title": "Леди в озере",
            "author": "Рэймонд Чандлер"
        },
        {
            "title": "Убить пересмешника",
            "author": "Харпер Ли"
        },
        {
            "title": "Наш человек в Гаване",
            "author": "Грэм Грин"
        },
        {
            "title": "Тайна Эдвина Друда",
            "author": "Чарльз Диккенс"
        },
        {
            "title": "Внезапная развязка",
            "author": "Питер Лавси"
        },
        {
            "title": "Эшенден, или Британский агент",
            "author": "Сомерсет Моэм"
        },
        {
            "title": "Семипроцентный раствор",
            "author": "Николас Мейер"
        },
        {
            "title": "Звонок в дверь",
            "author": "Рекс Стаут"
        },
        {
            "title": "Stick",
            "author": "Элмор Леонард"
        },
        {
            "title": "Маленькая барабанщица",
            "author": "Джон Ле Карре"
        },
        {
            "title": "Брайтонский леденец",
            "author": "Грэм Грин"
        },
        {
            "title": "Дракула",
            "author": "Брэм Стокер"
        },
        {
            "title": "Талантливый мистер Рипли",
            "author": "Патриция Хайсмит"
        },
        {
            "title": "Шагающий магазин игрушек",
            "author": "Эдмунд Криспин (Брюс Монтгомери)"
        },
        {
            "title": "Пора убивать",
            "author": "Джон Гришэм"
        },
        {
            "title": "Last Seen Wearing…",
            "author": "Хиллари Во"
        },
        {
            "title": "Маленький Цезарь",
            "author": "Уильям Райли Бернетт"
        },
        {
            "title": "Друзья Эдди Койла",
            "author": "Джордж Хиггинс"
        },
        {
            "title": "Под грузом улик",
            "author": "Дороти Ли Сэйерс"
        },
        {
            "title": "Из России с любовью",
            "author": "Ян Флеминг"
        },
        {
            "title": "Загнанный зверь",
            "author": "Маргарет Миллар"
        },
        {
            "title": "Бедняга Смилбон",
            "author": "Майкл Гилберт"
        },
        {
            "title": "Дело о похищении Бетти Кейн",
            "author": "Джозефина Тэй"
        },
        {
            "title": "Crocodile on the Sandbank",
            "author": "Элизабет Питерс (Барбара Миртц)"
        },
        {
            "title": "Тайна Найтингейла",
            "author": "Филлис Дороти Джеймс"
        },
        {
            "title": "Охота за „Красным Октябрём“",
            "author": "Том Клэнси"
        },
        {
            "title": "Chinaman’s Chance",
            "author": "Росс Томас"
        },
        {
            "title": "Тайный агент",
            "author": "Джозеф Конрад"
        },
        {
            "title": "The Dreadful Lemon Sky",
            "author": "Джон Макдональд"
        },
        {
            "title": "Стеклянный ключ",
            "author": "Дэшил Хэммет"
        },
        {
            "title": "A Judgement in Stone",
            "author": "Рут Ренделл"
        },
        {
            "title": "Мистификация",
            "author": "Джозефина Тэй"
        },
        {
            "title": "Озноб",
            "author": "Росс Макдональд"
        },
        {
            "title": "Дьявол в синем",
            "author": "Уолтер Мосли"
        },
        {
            "title": "The Choirboys",
            "author": "Джозеф Уэмбо"
        },
        {
            "title": "Блаженны скудоумные",
            "author": "Дональд Уэстлейк"
        },
        {
            "title": "Убийство по-домашнему",
            "author": "Крейг Райс"
        },
        {
            "title": "Три гроба",
            "author": "Джон Диксон Карр"
        },
        {
            "title": "Честь семьи Прицци",
            "author": "Ричард Кондон"
        },
        {
            "title": "Убийство по-южноафрикански",
            "author": "Джеймс Макклюр"
        },
        {
            "title": "Меж двух времён",
            "author": "Джек Финней"
        },
        {
            "title": "Страсти по мощам",
            "author": "Эллис Питерс"
        },
        {
            "title": "Ребёнок Розмари",
            "author": "Айра Левин"
        },
        {
            "title": "Шерлок Холмс",
            "author": "Артур Конан Дойл"
        },
        {
            "title": "Суд - это я",
            "author": "Микки Спиллейн"
        },
        {
            "title": "\"А\" - значит алиби",
            "author": "Сью Графтон"
        }
    ],
    "ya": [
        {
            "title": "Сумерки",
            "author": "Стефани Майер"
        },
        {
            "title": "Дэнни — чемпион мира",
            "author": "Роальд Даль"
        },
        {
            "title": "Хроники Прайдена",
            "author": "Александр Ллойд"
        },
        {
            "title": "Любители поговорить",
            "author": "Крис Кратчер"
        },
        {
            "title": "Сказки тайны и воображения",
            "author": "Эдгар Аллан По"
        },
        {
            "title": "Волшебник Земноморья",
            "author": "Урсула Ле Гуин"
        },
        {
            "title": "Секрет",
            "author": "Псевдонимус Босх"
        },
        {
            "title": "Тигр Лили",
            "author": "Джоди Линн Андерсон"
        },
        {
            "title": "Сабриэль",
            "author": "Гарт Никс"
        },
        {
            "title": "Хранитель времени",
            "author": "Брайан Селзник"
        },
        {
            "title": "Тайное общество мистера Бенедикта",
            "author": "Трентон Ли Стюарт"
        },
        {
            "title": "Король воров",
            "author": "Корнелия Функе"
        },
        {
            "title": "Миссис Фрисби и крысы НИПЗ",
            "author": "Роберт С. О’Брайен"
        },
        {
            "title": "Серый король",
            "author": "Сьюзан Купер"
        },
        {
            "title": "Ангел для Саффи",
            "author": "Хиллари Маккей"
        },
        {
            "title": "Когда мы встретимся",
            "author": "Ребекка Стед"
        },
        {
            "title": "Парящий тигр",
            "author": "Кейт Дикамилло"
        },
        {
            "title": "Сильный ветер на Ямайке",
            "author": "Ричард Хьюз"
        },
        {
            "title": "Падшие ангелы",
            "author": "Вальтер Дин Майерс"
        },
        {
            "title": "Мальчишеское доказательство",
            "author": "Сесиль Кастеллуччи"
        },
        {
            "title": "Поступь хаоса",
            "author": "Патрик Несс"
        },
        {
            "title": "Эсперанса",
            "author": "Пэм Муньос Райан"
        },
        {
            "title": "Луна Алабамы",
            "author": "Вотт Кей"
        },
        {
            "title": "Пигмэн",
            "author": "Пол Зиндел"
        },
        {
            "title": "В собачьей шкуре",
            "author": "Диана Джонс"
        },
        {
            "title": "Недобрый час",
            "author": "Фрэнсис Хардинг"
        },
        {
            "title": "Американец, рожденный китайцем",
            "author": "Джен Луэнг Янг"
        },
        {
            "title": "Город Бестий",
            "author": "Исабель Альенде"
        },
        {
            "title": "История с кладбищем",
            "author": "Нил Гейман"
        },
        {
            "title": "Боксеры и святые",
            "author": "Джен Луэнг Янг"
        },
        {
            "title": "Фридлэнд",
            "author": "Эндрю Клементс"
        },
        {
            "title": "Опасные ангелы",
            "author": "Франческа Лиа Блок"
        },
        {
            "title": "Ведьма с пруда Черных дроздов",
            "author": "Элизабет Спир"
        },
        {
            "title": "Рядовой Писфул",
            "author": "Майкл Морпурго"
        },
        {
            "title": "Одеяла",
            "author": "Крейг Томпсон"
        },
        {
            "title": "Сосчитай звезды",
            "author": "Луис Лоури"
        },
        {
            "title": "Там, где вещи возвращаются",
            "author": "Джон Вэллей"
        },
        {
            "title": "Каждый новый день",
            "author": "Дэвид Левитан"
        },
        {
            "title": "Венок для Эммет Тилл",
            "author": "Мерилин Нельсон"
        },
        {
            "title": "Человек в картинках",
            "author": "Рэй Брэдбери"
        },
        {
            "title": "Перси Джексон и Олимпийцы",
            "author": "Рик Риордан"
        },
        {
            "title": "Голос монстра",
            "author": "Патрик Несс"
        },
        {
            "title": "Стена",
            "author": "Петр Сис"
        },
        {
            "title": "Ради свободы",
            "author": "Кимберли Брубейкер Брэдли"
        },
        {
            "title": "Голодные игры",
            "author": "Сьюзен Коллинз"
        },
        {
            "title": "Годовалый",
            "author": "Майори Кинан Роулингс"
        },
        {
            "title": "Северное сияние",
            "author": "Дженнифер Доннелли"
        },
        {
            "title": "Виноваты звезды",
            "author": "Джон Грин"
        },
        {
            "title": "Мэри Поппинс",
            "author": "Памела Трэверс"
        },
        {
            "title": "Говори",
            "author": "Лори Холс Андерсон"
        },
        {
            "title": "Ветер в ивах",
            "author": "Кеннет Грэм"
        },
        {
            "title": "Игра Вестинга",
            "author": "Эллен Раскин"
        },
        {
            "title": "Джонни Треймен",
            "author": "Эстер Форбс"
        },
        {
            "title": "Тарзан торжествующий",
            "author": "Эдгар Берроуз"
        },
        {
            "title": "Бизус и Рамона",
            "author": "Биверли Клири"
        },
        {
            "title": "Принцесса-невеста",
            "author": "Уильям Голдман"
        },
        {
            "title": "Алхимик",
            "author": "Майкл Скотт"
        },
        {
            "title": "Корми нас, слабак Бургер",
            "author": "Мэтью Тобин Андерсон"
        },
        {
            "title": "Властелин колец",
            "author": "Джон Рональд Руэл Толкин"
        },
        {
            "title": "Топор",
            "author": "Гарри Паулсен"
        },
        {
            "title": "Иакова я возлюбил",
            "author": "Кэтрин Патерсон"
        },
        {
            "title": "33 несчастья",
            "author": "Лемони Сникет"
        },
        {
            "title": "Шоколадная война",
            "author": "Роберт Кормье"
        },
        {
            "title": "Шпионка Гарриет",
            "author": "Луис Фитцью"
        },
        {
            "title": "Сепаратный мир",
            "author": "Джон Ноулз"
        },
        {
            "title": "Зов предков",
            "author": "Джек Лондон"
        },
        {
            "title": "Мост в Терабитию",
            "author": "Кэтрин Патерсон"
        },
        {
            "title": "Алиса в Стране чудес",
            "author": "Льюис Кэрролл"
        },
        {
            "title": "Чарли и шоколадная фабрика",
            "author": "Роальд Даль"
        },
        {
            "title": "Повелитель мух",
            "author": "Уильям Голдинг"
        },
        {
            "title": "Удивительный волшебник Страны Оз",
            "author": "Лаймен Фрэнк Баум"
        },
        {
            "title": "Хоббит",
            "author": "Джон Рональд Руэл Толкин"
        },
        {
            "title": "Приключения Гекльберри Финна",
            "author": "Марк Твен"
        },
        {
            "title": "Маленькие женщины",
            "author": "Луиза Мэй Олкотт"
        },
        {
            "title": "Над пропастью во ржи",
            "author": "Джером Дэвид Сэлинджер"
        },
        {
            "title": "Меч в камне",
            "author": "Теренс Уайт"
        },
        {
            "title": "Чудо",
            "author": "Р. Дж. Паласио"
        },
        {
            "title": "Удивительное путешествие кролика Эдварда",
            "author": "Кейт Дикамилло"
        },
        {
            "title": "Домик в Прерии",
            "author": "Лора Инглз Уайлдер"
        },
        {
            "title": "Загадочное ночное убийство собаки",
            "author": "Марк Хэддон"
        },
        {
            "title": "В поисках Аляски",
            "author": "Джон Грин"
        },
        {
            "title": "Из архива миссис Базиль Э. Франквайлер, самого запутанного в мире",
            "author": "Элейн Лобл Конигсбург"
        },
        {
            "title": "Дневник Анны Франк",
            "author": "Анна Франк"
        },
        {
            "title": "Золотой компас",
            "author": "Филип Пулман"
        },
        {
            "title": "Монстр",
            "author": "Вальтер Дин Майерс"
        },
        {
            "title": "Хроники Нарнии",
            "author": "Клайв Стейплз Льюис"
        },
        {
            "title": "Аня из Зеленых Мезонинов",
            "author": "Люси Мод Монтгомери"
        },
        {
            "title": "И грянул гром, услышь крик мой",
            "author": "Милдред Тейлор"
        },
        {
            "title": "Убить пересмешника",
            "author": "Харпер Ли"
        },
        {
            "title": "Ты здесь, Бог? Это я, Маргарет",
            "author": "Джуди Блум"
        },
        {
            "title": "Дающий",
            "author": "Лоис Лоури"
        },
        {
            "title": "Призрачная будка",
            "author": "Нортон Джастер"
        },
        {
            "title": "Изгои",
            "author": "Сьюзан Хинтон"
        },
        {
            "title": "Матильда",
            "author": "Роальд Даль"
        },
        {
            "title": "Дыры",
            "author": "Луис Сейкер"
        },
        {
            "title": "Паутина Шарлотты",
            "author": "Элвин Брукс Уайт"
        },
        {
            "title": "Излом времени",
            "author": "Мадлен Л’Энгл"
        },
        {
            "title": "Книжный вор",
            "author": "Маркус Зусак"
        },
        {
            "title": "Гарри Поттер и философский камень",
            "author": "Джоан Роулинг"
        },
        {
            "title": "Абсолютно правдивый дневник индейца на полставки",
            "author": "Шерман Алекси"
        }
    ],
    "thriller": [
        {
            "title": "Мизери",
            "author": "Стивен Кинг"
        },
        {
            "title": "Сияние",
            "author": "Стивен Кинг"
        },
        {
            "title": "Оно",
            "author": "Стивен Кинг"
        },
        {
            "title": "The Sandman. Песочный человек. Книга 1. Прелюдии и ноктюрны",
            "author": "Сэм Кит"
        },
        {
            "title": "Косиног. История о колдовстве",
            "author": "Джеральд Бром"
        },
        {
            "title": "Институт",
            "author": "Стивен Кинг"
        },
        {
            "title": "Коралина",
            "author": "Нил Гейман"
        },
        {
            "title": "Куджо",
            "author": "Стивен Кинг"
        },
        {
            "title": "Дикая охота короля Стаха",
            "author": "Владимир Короткевич"
        },
        {
            "title": "Ночная смена (сборник)",
            "author": "Стивен Кинг"
        },
        {
            "title": "Лес",
            "author": "Светлана Тюльбашева"
        },
        {
            "title": "Убийство на улице Морг (сборник)",
            "author": "Эдгар Аллан По"
        },
        {
            "title": "Безнадёга",
            "author": "Стивен Кинг"
        },
        {
            "title": "Странная история доктора Джекила и мистера Хайда",
            "author": "Роберт Льюис Стивенсон"
        },
        {
            "title": "Блейз (сборник)",
            "author": "Ричард Бахман"
        },
        {
            "title": "Полное собрание рассказов в одном томе",
            "author": "Эдгар Аллан По"
        },
        {
            "title": "Монстролог. Проклятье Вендиго",
            "author": "Рик Янси"
        },
        {
            "title": "Дом на краю темноты",
            "author": "Райли Сейгер"
        },
        {
            "title": "Потерянный мальчишка. Подлинная история капитана Крюка",
            "author": "Кристина Генри"
        },
        {
            "title": "Дракула (сборник)",
            "author": "Брэм Стокер"
        },
        {
            "title": "Книга потерянных вещей",
            "author": "Джон Коннолли"
        },
        {
            "title": "Темная половина",
            "author": "Стивен Кинг"
        },
        {
            "title": "Обещанная страна грёз. Книга 2",
            "author": "Каиу Сираи"
        },
        {
            "title": "Гиблое место",
            "author": "Стивен Кинг"
        },
        {
            "title": "Тот, кто хочет выжить",
            "author": "Стивен Кинг"
        },
        {
            "title": "Изгоняющий дьявола",
            "author": "Уильям Питер Блэтти"
        },
        {
            "title": "Кровавый остров",
            "author": "Рик Янси"
        },
        {
            "title": "История Чарльза Декстера Варда (сборник)",
            "author": "Говард Лавкрафт"
        },
        {
            "title": "1408",
            "author": "Стивен Кинг"
        },
        {
            "title": "Мобильник",
            "author": "Стивен Кинг"
        },
        {
            "title": "Добро пожаловать в мертвый дом",
            "author": "Р. Л. Стайн"
        },
        {
            "title": "Пригласи меня войти",
            "author": "Дженнифер Макмахон"
        },
        {
            "title": "Мотель «Вечерняя заря»",
            "author": "Симона Сент-Джеймс"
        },
        {
            "title": "Дзікае паляванне караля Стаха (сборник)",
            "author": "Уладзімір Караткевіч"
        },
        {
            "title": "Санкта-Психо",
            "author": "Юхан Теорин"
        },
        {
            "title": "Американский вампир",
            "author": "Стивен Кинг"
        },
        {
            "title": "The Birds",
            "author": "Daphne du Maurier"
        },
        {
            "title": "Бабуля",
            "author": "Стивен Кинг"
        },
        {
            "title": "Фотография класса за этот год",
            "author": "Дэн Симмонс"
        },
        {
            "title": "Томминокеры",
            "author": "Стивен Кинг"
        },
        {
            "title": "Случай Чарльза Декстера Варда",
            "author": "Говард Филлипс Лавкрафт"
        },
        {
            "title": "Девушка по соседству",
            "author": "Джек Кетчам"
        },
        {
            "title": "Блейз",
            "author": "Стивен Кинг"
        },
        {
            "title": "Ступени, ведущие в бездну",
            "author": "Рик Янси"
        },
        {
            "title": "Изысканный труп",
            "author": "Поппи Брайт"
        },
        {
            "title": "Ритуал",
            "author": "Адам Нэвилл"
        },
        {
            "title": "БАБАЙ",
            "author": "Стівен Кінг"
        },
        {
            "title": "Война миров Z",
            "author": "Макс Брукс"
        },
        {
            "title": "Мерзость",
            "author": "Дэн Симмонс"
        },
        {
            "title": "Преждевременное погребение",
            "author": "Эдгар Аллан По"
        },
        {
            "title": "Мертвые голоса",
            "author": "Кэтрин Арден"
        },
        {
            "title": "Дорожные работы",
            "author": "Ричард Бахман"
        },
        {
            "title": "Судные дни",
            "author": "Адам Нэвилл"
        },
        {
            "title": "Мальчик, который видел демонов",
            "author": "Кэролин Джесс-Кук"
        },
        {
            "title": "Штамм. Книга 1. Начало",
            "author": "Гильермо дель Торо, Чак Хоган"
        },
        {
            "title": "Дом в овраге",
            "author": "Александр Варго"
        },
        {
            "title": "Любовь мертвеца (сборник)",
            "author": "Дзюндзи Ито"
        },
        {
            "title": "Опасные желания",
            "author": "Эрин А. Крейг"
        },
        {
            "title": "Мужчина, который любил цветы",
            "author": "Стивен Кинг"
        },
        {
            "title": "Плот",
            "author": "Стивен Кинг"
        },
        {
            "title": "В этой книге полно пауков. Серьезно, чувак, не трогай ее",
            "author": "Дэвид Вонг"
        },
        {
            "title": "Блаженны мёртвые",
            "author": "Йон Айвиде Линдквист"
        },
        {
            "title": "Детишки в доме на холме",
            "author": "Дженнифер Макмахон"
        },
        {
            "title": "Воскреситель, или Анатомия фантастических существ: Утерянный труд доктора Спенсера Блэка",
            "author": "Эрик Б. Хадспет"
        },
        {
            "title": "Тени теней",
            "author": "Алекс Норт"
        },
        {
            "title": "Нечто",
            "author": "Джон Кэмпбелл"
        },
        {
            "title": "Кайдан (сборник)",
            "author": "Дзюндзи Ито"
        },
        {
            "title": "Н.",
            "author": "Стивен Кинг"
        },
        {
            "title": "Кусака",
            "author": "Роберт Маккаммон"
        },
        {
            "title": "Цикл оборотня",
            "author": "Стивен Кинг"
        },
        {
            "title": "Адова кошка",
            "author": "Стивен Кинг"
        },
        {
            "title": "Приют",
            "author": "Патрик Макграт"
        },
        {
            "title": "Странный Томас",
            "author": "Дин Кунц"
        },
        {
            "title": "Баллада о гибкой пуле (сборник)",
            "author": "Стивен Кинг"
        },
        {
            "title": "Сожженные девочки",
            "author": "С. Дж. Тюдор"
        },
        {
            "title": "Последний дом на Никчемной улице",
            "author": "Катриона Уорд"
        },
        {
            "title": "Полный газ",
            "author": "Джо Хилл"
        },
        {
            "title": "Пляска смерти",
            "author": "Стивен Кинг"
        },
        {
            "title": "The Dagger in the Desk",
            "author": "Jonathan Stroud"
        },
        {
            "title": "Песнь Кали",
            "author": "Дэн Симмонс"
        },
        {
            "title": "Последний свидетель",
            "author": "Клэр Макфолл"
        },
        {
            "title": "Сны Ктулху",
            "author": "Говард Филлипс Лавкрафт"
        },
        {
            "title": "Чужой",
            "author": "Алан Дин Фостер"
        },
        {
            "title": "Обезьянья лапа",
            "author": "Уильям Уаймарк Джейкобс"
        },
        {
            "title": "Предсказание",
            "author": "Дин Кунц"
        },
        {
            "title": "Кракен",
            "author": "Чайна Мьевиль"
        },
        {
            "title": "Некрофил",
            "author": "Габриэль Витткоп"
        },
        {
            "title": "Деда",
            "author": "Стивен Кинг"
        },
        {
            "title": "Гот",
            "author": "Оцуити"
        },
        {
            "title": "Чудовищная кровища",
            "author": "Р. Л. Стайн"
        },
        {
            "title": "«Золотой жук» и другие мистические истории",
            "author": "Эдгар Аллан По"
        },
        {
            "title": "Плохой мальчишка",
            "author": "Стивен Кинг"
        },
        {
            "title": "Король в желтом",
            "author": "Роберт Чамберс"
        },
        {
            "title": "Зайка",
            "author": "Мона Авад"
        },
        {
            "title": "Гора вампиров",
            "author": "Даррен Шэн"
        },
        {
            "title": "Милые детки",
            "author": "Мелани Голдинг"
        },
        {
            "title": "Милосердные",
            "author": "Федерико Андахази"
        },
        {
            "title": "Тебе не спрятаться",
            "author": "Дэн Поблоки"
        },
        {
            "title": "Ужин начинается в полночь. Семь жутких историй",
            "author": "Росс Монтгомери"
        }
    ],
    "serious": [
        {
            "title": "Властелин колец",
            "author": "Джон Р. Р. Толкин"
        },
        {
            "title": "Гордость и предубеждение",
            "author": "Джейн Остин"
        },
        {
            "title": "Тёмные начала",
            "author": "Филип Пулман"
        },
        {
            "title": "Автостопом по галактике",
            "author": "Дуглас Адамс"
        },
        {
            "title": "Гарри Поттер и Кубок огня",
            "author": "Джоан Роулинг"
        },
        {
            "title": "Убить пересмешника",
            "author": "Харпер Ли"
        },
        {
            "title": "Винни Пух",
            "author": "Алан Александр Милн"
        },
        {
            "title": "1984",
            "author": "Джордж Оруэлл"
        },
        {
            "title": "Лев, колдунья и платяной шкаф",
            "author": "Клайв Стэйплз Льюис"
        },
        {
            "title": "Джейн Эйр",
            "author": "Шарлотта Бронте"
        },
        {
            "title": "Уловка-22",
            "author": "Джозеф Хеллер"
        },
        {
            "title": "Грозовой перевал",
            "author": "Эмили Бронте"
        },
        {
            "title": "Пение птиц",
            "author": "Себастьян Фолкс"
        },
        {
            "title": "Ребекка",
            "author": "Дафна Дюморье"
        },
        {
            "title": "Над пропастью во ржи",
            "author": "Джером Сэлинджер"
        },
        {
            "title": "Ветер в ивах",
            "author": "Кеннет Грэм"
        },
        {
            "title": "Большие надежды",
            "author": "Чарльз Диккенс"
        },
        {
            "title": "Маленькие женщины",
            "author": "Луиза Мэй Олкотт"
        },
        {
            "title": "Мандолина капитана Корелли",
            "author": "Луи де Берньер"
        },
        {
            "title": "Война и мир",
            "author": "Лев Толстой"
        },
        {
            "title": "Унесённые ветром",
            "author": "Маргарет Митчелл"
        },
        {
            "title": "Гарри Поттер и философский камень",
            "author": "Джоан Роулинг"
        },
        {
            "title": "Гарри Поттер и Тайная комната",
            "author": "Джоан Роулинг"
        },
        {
            "title": "Гарри Поттер и узник Азкабана",
            "author": "Джоан Роулинг"
        },
        {
            "title": "Хоббит, или Туда и обратно",
            "author": "Джон Р. Р. Толкин"
        },
        {
            "title": "Тэсс из рода д’Эрбервиллей",
            "author": "Томас Харди"
        },
        {
            "title": "Миддлмарч",
            "author": "Джордж Элиот"
        },
        {
            "title": "Молитва об Оуэне Мини",
            "author": "Джон Ирвинг"
        },
        {
            "title": "Гроздья гнева",
            "author": "Джон Стейнбек"
        },
        {
            "title": "Алиса в Стране чудес",
            "author": "Льюис Кэрролл"
        },
        {
            "title": "Дневник Трейси Бикер",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Сто лет одиночества",
            "author": "Габриэль Гарсиа Маркес"
        },
        {
            "title": "Столпы Земли",
            "author": "Кен Фоллетт"
        },
        {
            "title": "Дэвид Копперфильд",
            "author": "Чарльз Диккенс"
        },
        {
            "title": "Чарли и шоколадная фабрика",
            "author": "Роальд Даль"
        },
        {
            "title": "Остров сокровищ",
            "author": "Роберт Стивенсон"
        },
        {
            "title": "Город как Элис",
            "author": "Невил Шют"
        },
        {
            "title": "Доводы рассудка",
            "author": "Джейн Остин"
        },
        {
            "title": "Дюна",
            "author": "Фрэнк Герберт"
        },
        {
            "title": "Эмма",
            "author": "Джейн Остин"
        },
        {
            "title": "Аня из Зелёных Мезонинов",
            "author": "Люси Мод Монтгомери"
        },
        {
            "title": "Обитатели холмов",
            "author": "Ричард Адамс"
        },
        {
            "title": "Великий Гэтсби",
            "author": "Фрэнсис Скотт Фицджеральд"
        },
        {
            "title": "Граф Монте-Кристо",
            "author": "Александр Дюма"
        },
        {
            "title": "Возвращение в Брайдсхед",
            "author": "Ивлин Во"
        },
        {
            "title": "Скотный двор",
            "author": "Джордж Оруэлл"
        },
        {
            "title": "Рождественская песнь",
            "author": "Чарльз Диккенс"
        },
        {
            "title": "Вдали от обезумевшей толпы",
            "author": "Томас Харди"
        },
        {
            "title": "Спокойной ночи, мистер Том",
            "author": "Мишель Магорян"
        },
        {
            "title": "Семейная реликвия",
            "author": "Розамунд Пилчер"
        },
        {
            "title": "Таинственный сад",
            "author": "Фрэнсис Бернетт"
        },
        {
            "title": "О мышах и людях",
            "author": "Джон Стейнбек"
        },
        {
            "title": "Противостояние",
            "author": "Стивен Кинг"
        },
        {
            "title": "Анна Каренина",
            "author": "Лев Толстой"
        },
        {
            "title": "Подходящий жених",
            "author": "Викрам Сет"
        },
        {
            "title": "БДВ, или Большой и добрый великан",
            "author": "Роальд Даль"
        },
        {
            "title": "Ласточки и амазонки",
            "author": "Артур Рэнсом"
        },
        {
            "title": "Чёрный красавчик",
            "author": "Анна Сьюэлл"
        },
        {
            "title": "Артемис Фаул",
            "author": "Йон Колфер"
        },
        {
            "title": "Преступление и наказание",
            "author": "Фёдор Достоевский"
        },
        {
            "title": "Крестики-нолики",
            "author": "Мэлори Блэкмен"
        },
        {
            "title": "Мемуары гейши",
            "author": "Артур Голден"
        },
        {
            "title": "Повесть о двух городах",
            "author": "Чарльз Диккенс"
        },
        {
            "title": "Поющие в терновнике",
            "author": "Колин Маккалоу"
        },
        {
            "title": "Мор, ученик Смерти",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Трое в лодке, не считая собаки",
            "author": "Джером К. Джером"
        },
        {
            "title": "Мелкие боги",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Пляж",
            "author": "Алекс Гарленд"
        },
        {
            "title": "Дракула",
            "author": "Брэм Стокер"
        },
        {
            "title": "Белый пик",
            "author": "Энтони Горовиц"
        },
        {
            "title": "Посмертные записки Пиквикского клуба",
            "author": "Чарльз Диккенс"
        },
        {
            "title": "Громобой",
            "author": "Энтони Горовиц"
        },
        {
            "title": "Осиная фабрика",
            "author": "Иэн Бэнкс"
        },
        {
            "title": "День Шакала",
            "author": "Фредерик Форсайт"
        },
        {
            "title": "Разрисованная мама",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Джуд Незаметный",
            "author": "Томас Харди"
        },
        {
            "title": "Тайный дневник Адриана Моула, 13 3/4 лет",
            "author": "Сью Таунсенд"
        },
        {
            "title": "Жестокое море",
            "author": "Николас Монсаррат"
        },
        {
            "title": "Отверженные",
            "author": "Виктор Гюго"
        },
        {
            "title": "Мэр Кэстербриджа",
            "author": "Томас Харди"
        },
        {
            "title": "Рискованные игры",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Плохие девчонки",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Портрет Дориана Грея",
            "author": "Оскар Уайльд"
        },
        {
            "title": "Сёгун",
            "author": "Джеймс Клавелл"
        },
        {
            "title": "День триффидов",
            "author": "Джон Уиндем"
        },
        {
            "title": "Лола Роза",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Ярмарка тщеславия",
            "author": "Уильям Теккерей"
        },
        {
            "title": "Дом листьев",
            "author": "Марк Данилевский"
        },
        {
            "title": "Сага о Форсайтах",
            "author": "Джон Голсуорси"
        },
        {
            "title": "Библия ядовитого леса",
            "author": "Барбара Кингсолвер"
        },
        {
            "title": "Мрачный Жнец",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Ангус, ремни и конкретные обжимашки",
            "author": "Луиз Рэннисон"
        },
        {
            "title": "Собака Баскервилей",
            "author": "Артур Конан Дойль"
        },
        {
            "title": "Обладать",
            "author": "Антония Сьюзен Байетт"
        },
        {
            "title": "Мастер и Маргарита",
            "author": "Михаил Булгаков"
        },
        {
            "title": "Рассказ служанки",
            "author": "Маргарет Этвуд"
        },
        {
            "title": "Денни — чемпион мира",
            "author": "Роальд Даль"
        },
        {
            "title": "К востоку от рая",
            "author": "Джон Стейнбек"
        },
        {
            "title": "Лечение Джорджа Марвелуса",
            "author": "Роальд Даль"
        },
        {
            "title": "Вещие сестрички",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Пурпурный цвет",
            "author": "Элис Уокер"
        },
        {
            "title": "Санта-Хрякус",
            "author": "Терри Пратчетт"
        },
        {
            "title": "39 ступеней",
            "author": "Джон Бакен"
        },
        {
            "title": "Девчонки в слезах",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Вечеринка с ночёвкой",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "На западном фронте без перемен",
            "author": "Эрих Мария Ремарк"
        },
        {
            "title": "В хранилищах музея",
            "author": "Кейт Аткинсон"
        },
        {
            "title": "Hi-Fi",
            "author": "Ник Хорнби"
        },
        {
            "title": "Оно",
            "author": "Стивен Кинг"
        },
        {
            "title": "Джеймс и гигантский персик",
            "author": "Роальд Даль"
        },
        {
            "title": "Зелёная миля",
            "author": "Стивен Кинг"
        },
        {
            "title": "Мотылёк",
            "author": "Анри Шарьер"
        },
        {
            "title": "К оружию! К оружию!",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Хозяин морей: Командир и штурман",
            "author": "Патрик О’Брайан"
        },
        {
            "title": "Ключ от всех дверей",
            "author": "Энтони Горовиц"
        },
        {
            "title": "Роковая музыка",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Вор времени",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Пятый элефант",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Искупление",
            "author": "Иэн Макьюэн"
        },
        {
            "title": "Секреты",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Серебряный меч",
            "author": "Иэн Серрайе"
        },
        {
            "title": "Пролетая над гнездом кукушки",
            "author": "Кен Кизи"
        },
        {
            "title": "Сердце тьмы",
            "author": "Джозеф Конрад"
        },
        {
            "title": "Ким",
            "author": "Редьярд Киплинг"
        },
        {
            "title": "Чужестранка",
            "author": "Диана Гэблдон"
        },
        {
            "title": "Моби Дик",
            "author": "Герман Мелвилл"
        },
        {
            "title": "Песнь на закате",
            "author": "Льюис Грессик Гиббон"
        },
        {
            "title": "Корабельные новости",
            "author": "Энни Пру"
        },
        {
            "title": "Божество реки",
            "author": "Уилбур Смит"
        },
        {
            "title": "Мир глазами Гарпа",
            "author": "Джон Ирвинг"
        },
        {
            "title": "Лорна Дун",
            "author": "Ричард Блэкмор"
        },
        {
            "title": "Девчонки гуляют допоздна",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Далёкие шатры",
            "author": "Мэри Маргарет Кей"
        },
        {
            "title": "Ведьмы",
            "author": "Роальд Даль"
        },
        {
            "title": "Паутина Шарлотты",
            "author": "Элвин Брукс Уайт"
        },
        {
            "title": "Франкенштейн, или Современный Прометей",
            "author": "Мэри Шелли"
        },
        {
            "title": "Они играли на траве",
            "author": "Терри Венейблс и Гордон М. Уильямс"
        },
        {
            "title": "Старик и море",
            "author": "Эрнест Хемингуэй"
        },
        {
            "title": "Лолита",
            "author": "Владимир Набоков"
        },
        {
            "title": "Имя розы",
            "author": "Умберто Эко"
        },
        {
            "title": "Мир Софии",
            "author": "Юстейн Гордер"
        },
        {
            "title": "Девочка-находка",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Изумительный мистер Лис",
            "author": "Роальд Даль"
        },
        {
            "title": "Чайка по имени Джонатан Ливингстон",
            "author": "Ричард Бах"
        },
        {
            "title": "Маленький принц",
            "author": "Антуан де Сент-Экзюпери"
        },
        {
            "title": "Дитя из чемодана",
            "author": "Жаклин Уилсон"
        },
        {
            "title": "Приключения Оливера Твиста",
            "author": "Чарльз Диккенс"
        },
        {
            "title": "Сила единства",
            "author": "Брайс Кортни"
        },
        {
            "title": "Сайлес Марнер",
            "author": "Джордж Элиот"
        },
        {
            "title": "Американский психопат",
            "author": "Брет Истон Эллис"
        },
        {
            "title": "Дневник незначительного лица",
            "author": "Джордж и Уидон Гроссмит"
        },
        {
            "title": "На игле",
            "author": "Ирвин Уэлш"
        },
        {
            "title": "Хайди",
            "author": "Иоганна Спири"
        },
        {
            "title": "Сыновья и любовники",
            "author": "Дэвид Герберт Лоуренс"
        },
        {
            "title": "Невыносимая лёгкость бытия",
            "author": "Милан Кундера"
        },
        {
            "title": "Мужчина и мальчик",
            "author": "Тони Парсонс"
        },
        {
            "title": "Правда",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Война миров",
            "author": "Герберт Уэллс"
        },
        {
            "title": "Ужастики",
            "author": "Роберт Лоуренс Стайн"
        },
        {
            "title": "Заклинатель лошадей",
            "author": "Николас Эванс"
        },
        {
            "title": "Хрупкое равновесие",
            "author": "Рохинтон Мистри"
        },
        {
            "title": "Ведьмы за границей",
            "author": "Терри Пратчетт"
        },
        {
            "title": "Король былого и грядущего",
            "author": "Теренс Уайт"
        },
        {
            "title": "Очень голодная гусеница",
            "author": "Эрик Карл"
        },
        {
            "title": "Цветы на чердаке",
            "author": "Вирджиния Эндрюс"
        }
    ]
};
window.books = books;

/* ====== ГИБРИДНЫЙ РЕЖИМ: твои поля в приоритете + авто-описания из API + кэш ====== */

// делаем объект books видимым глобально (если ещё не сделали)
window.books = window.books || books;

// ---------- настройки и утилиты ----------
const GOOGLE_API_KEY = "";                       // можно пустым
const LANGS = ["ru","lv","en"];
const NEGATIVE = "-magazine -periodical -journal -gardening";
const CACHE_KEY = "book_desc_cache_v1";

const $ = id => document.getElementById(id);
const pick = arr => arr[Math.floor(Math.random()*arr.length)];
const clean = s => (s||"").replace(/\s+/g," ").trim();
const norm  = s => clean(s).toLowerCase().replace(/ё/g,"е");
function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function asEntry(item){
  if (typeof item !== "string") return item;
  let str = item.trim();
  let i = str.lastIndexOf("—"); if (i === -1) i = str.lastIndexOf("-");
  let title = str, author = "";
  if (i > 0){ title = str.slice(0,i).trim(); author = str.slice(i+1).trim(); }
  return { title, author };
}

// ---------- кэш (localStorage) ----------
function cacheGet(key){
  try {
    const all = JSON.parse(localStorage.getItem(CACHE_KEY) || "{}");
    return all[key] || null;
  } catch { return null; }
}
function cacheSet(key, value){
  try {
    const all = JSON.parse(localStorage.getItem(CACHE_KEY) || "{}");
    all[key] = { ...value, ts: Date.now() };
    localStorage.setItem(CACHE_KEY, JSON.stringify(all));
  } catch {}
}
function cacheKeyFor(entry){
  return norm(entry.title)+"|"+norm(entry.author||"");
}

// ---------- рендер ----------
function render(entry){
  const result = $("result");
  if (!result) return;

  const title = entry.title || "Без названия";
  const author = entry.author || "Автор неизвестен";
  const description = entry.description || "Описание пока не добавлено.";
  const cover = entry.cover || "";
  const link  = entry.infoLink || "";

  result.style.display = "block";
  result.innerHTML = `
    <h2>«${escapeHtml(title)}» — ${escapeHtml(author)}</h2>
    <p style="font-size:18px;">${escapeHtml(description)}</p>
    ${cover ? `<img id="book-cover" src="${cover}" alt="Обложка книги">` : ""}
    ${link ? `<p><a href="${link}" target="_blank" style="color:#0033cc;font-weight:bold;">Подробнее</a></p>` : ""}
  `;
}

// ---------- источники данных ----------
function wrapGB(item){
  const v = item.volumeInfo || {};
  return {
    id: item.id,
    title: clean(v.title),
    authors: (v.authors||[]).map(clean),
    lang: v.language || "",
    categories: v.categories || [],
    pageCount: v.pageCount || 0,
    printType: v.printType || "",
    description: clean(v.description || ""),
    image: (v.imageLinks && (v.imageLinks.thumbnail || v.imageLinks.smallThumbnail)) || "",
    infoLink: v.infoLink || item.selfLink || ""
  };
}
function filterGB({title, author}){
  const nt = norm(title||"");
  const na = norm(author||"");
  return x=>{
    if (x.printType && x.printType.toLowerCase() !== "book") return false;
    const cats = (x.categories||[]).join(" ").toLowerCase();
    if (/garden|сад|огород|periodical|magazine|журнал/.test(cats)) return false;
    if (x.pageCount && x.pageCount < 80) return false;
    const tOk = nt ? norm(x.title).includes(nt) : true;
    const aOk = na ? (x.authors||[]).some(a=>norm(a).includes(na) || na.includes(norm(a))) : true;
    return tOk && aOk;
  };
}
async function gbFullById(id){
  const u = new URL(`https://www.googleapis.com/books/v1/volumes/${encodeURIComponent(id)}`);
  if (GOOGLE_API_KEY) u.searchParams.set("key", GOOGLE_API_KEY);
  const r = await fetch(u); if (!r.ok) return null;
  return wrapGB(await r.json());
}
async function gbTry(url, query){
  const r = await fetch(url); if (!r.ok) return null;
  const items = ((await r.json()).items||[]).map(wrapGB).filter(filterGB(query));
  if (!items.length) return null;
  // выбираем лучший: с описанием → с обложкой → самый объёмный
  const withDesc = items.filter(x=>x.description && x.description.length>30);
  if (withDesc.length){
    withDesc.sort((a,b)=>(+(!!b.image)-+(!!a.image)) || (b.pageCount-a.pageCount));
    return withDesc[0];
  }
  const withImg = items.filter(x=>x.image);
  if (withImg.length){
    withImg.sort((a,b)=>b.pageCount-a.pageCount);
    return withImg[0];
  }
  items.sort((a,b)=>b.pageCount-a.pageCount);
  return items[0];
}
async function fromGoogle(entry){
  const base = new URL("https://www.googleapis.com/books/v1/volumes");
  const parts = [];
  if (entry.title)  parts.push(`intitle:"${entry.title.replace(/"/g,"")}"`);
  if (entry.author) parts.push(`inauthor:"${entry.author.replace(/"/g,"")}"`);
  parts.push(NEGATIVE);
  base.searchParams.set("q", parts.join(" "));
  base.searchParams.set("printType","books");
  base.searchParams.set("maxResults","20");
  base.searchParams.set("orderBy","relevance");
  if (GOOGLE_API_KEY) base.searchParams.set("key", GOOGLE_API_KEY);

  for (const lang of LANGS){
    const u = new URL(base); u.searchParams.set("langRestrict", lang);
    const picked = await gbTry(u, entry);
    if (picked){
      if (!picked.description && picked.id){
        const full = await gbFullById(picked.id);
        if (full && full.description) return full;
      }
      return picked;
    }
  }
  return await gbTry(base, entry);
}

// Open Library (fallback)
function fromOLWrapDoc(doc){
  const title = clean(doc.title);
  const authors = (doc.author_name||[]).map(clean);
  const cover = doc.cover_i ? `https://covers.openlibrary.org/b/id/${doc.cover_i}-L.jpg` : "";
  const key = doc.key || doc.work_key || doc.edition_key?.[0];
  const infoLink = key ? `https://openlibrary.org${key}` : "";
  return { title, authors, image: cover, infoLink };
}
async function fromOpenLibrary(entry){
  const q = new URL("https://openlibrary.org/search.json");
  if (entry.title)  q.searchParams.set("title", entry.title);
  if (entry.author) q.searchParams.set("author", entry.author);
  q.searchParams.set("limit","5");
  const r = await fetch(q); if (!r.ok) return null;
  const data = await r.json();
  const docs = data.docs || [];
  if (!docs.length) return null;

  // берём лучший по наличию обложки/году/количеству страниц
  docs.sort((a,b)=>(+(!!b.cover_i)-+(!!a.cover_i)) || ((b.first_publish_year||0)-(a.first_publish_year||0)) || ((b.number_of_pages_median||0)-(a.number_of_pages_median||0)));
  const d = docs[0];
  const base = fromOLWrapDoc(d);

  // описание из /works/{key}.json или edition
  let description = "";
  try {
    const workKey = (d.key || (d.work_key && d.work_key[0]));
    if (workKey){
      const wr = await fetch(`https://openlibrary.org${workKey}.json`);
      if (wr.ok){
        const wj = await wr.json();
        if (typeof wj.description === "string") description = wj.description;
        else if (wj.description && wj.description.value) description = wj.description.value;
      }
    }
  } catch {}
  return { ...base, description: clean(description) };
}

// объединяем данные с приоритетом твоих полей
function mergeEntry(entry, fetched){
  const out = { ...entry };
  if (!out.author && fetched?.authors?.length) out.author = fetched.authors.join(", ");
  if (!out.description && fetched?.description) out.description = fetched.description;
  if (!out.cover && fetched?.image) out.cover = fetched.image;
  if (!out.infoLink && fetched?.infoLink) out.infoLink = fetched.infoLink;
  return out;
}

// ---------- главная функция ----------
async function recommend(category){
  const result = $("result");
  const list = (window.books && Array.isArray(window.books[category])) ? window.books[category] : [];
  if (!list.length){
    if (result){ result.style.display="block"; result.innerHTML = "<em>Список пуст для этой категории.</em>"; }
    return;
  }

  let entry = asEntry(pick(list)); // {title, author, ...}

  // 1) если у тебя уже есть description/cover — просто показываем
  if (entry.description || entry.cover){ return render(entry); }

  // 2) кэш
  const key = cacheKeyFor(entry);
  const cached = cacheGet(key);
  if (cached){ return render({ ...entry, ...cached }); }

  // 3) Google Books → Open Library
  try {
    const gb = await fromGoogle(entry);
    if (gb){
      const merged = mergeEntry(entry, gb);
      cacheSet(key, { description: merged.description||"", cover: merged.cover||"", infoLink: merged.infoLink||"" });
      return render(merged);
    }
    const ol = await fromOpenLibrary(entry);
    if (ol){
      const merged = mergeEntry(entry, ol);
      cacheSet(key, { description: merged.description||"", cover: merged.cover||"", infoLink: merged.infoLink||"" });
      return render(merged);
    }
  } catch (e) { console.error(e); }

  // 4) если ничего не нашли — аккуратная заглушка
  return render(entry);
}

// экспорт для кнопок
window.recommend = recommend;
